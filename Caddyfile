# 根路径监听，端口使用 Nixpacks 注入的 $PORT
:{$PORT:80} {

    # 静态文件根目录，由 Nixpacks 注入 PUBLIC_ROOT，一般是 dist
    root * {$PUBLIC_ROOT}

    # 开启 gzip / zstd 压缩
    encode gzip zstd

    # 关键：SPA 路由兜底
    # 1. 先尝试按原始路径找静态文件
    # 2. 再尝试目录形式（/path/）
    # 3. 如果都不存在，则回退到 /index.html，由前端路由接管
    try_files {path} {path}/ /index.html

    # 静态文件服务
    file_server
}